<!DOCTYPE html>
<html lang="ru"><head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Тестируем RAM, SSD и HDD на скорость</title>
    <meta name="description">
    <meta name="keywords">
    <meta content="kV0pbQhJgmKN4HYX_lWYGipG-w7cKmFleQ-4ZbkAQX0" name="google-site-verification"><link href="../../favicon.png?1354701016" rel="icon" type="image/png" /><link href="../../stylesheets/reset.css?1354701016" media="screen" rel="stylesheet" type="text/css" /><link href="../../stylesheets/main.css?1354701016" media="screen" rel="stylesheet" type="text/css" /><link href="../../stylesheets/syntax.css?1354701016" media="screen" rel="stylesheet" type="text/css" /><script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
    <script src="../../javascripts/core.js?1354701016" type="text/javascript"></script></head><body>
    <div id="container"><div id="header">
        <div class="logo">
          <a href="/"><img src="/images/logo_hover.png"><img class="overlay" src="/images/logo.png"></a>
        </div>
        <div class="about">
          <h1>
            <a href="/">artemeff</a> &mdash; Ruby on Rails developer</h1>
          <span>Программы должны быть написаны так, чтобы их могли читать люди, и лишь иногда так, чтобы их могли выполнять машины.</span>
        </div>
        <div class="navigation">
          <a href="/">Главная</a><br><a href="/projects.html">Проекты</a><br><a href="/contacts.html">Контакты</a><br><a href="/about_me.html">Кто такой?</a>
        </div>
      </div>
      <div class="line"></div><div id="main">
        <div class="posts">
          <div class="post">
            <div class="meta">Ноябрь 24, 2012<p>
                <a href="#comments">комментарии</a>
              </p>
              <ul class="tags">
                <li>
                  <a href="/tags/ram.html">ram</a>
                </li>
                <li>
                  <a href="/tags/ssd.html">ssd</a>
                </li>
                <li>
                  <a href="/tags/hdd.html">hdd</a>
                </li>
                <li>
                  <a href="/tags/server-side.html">server-side</a>
                </li>
                <li>
                  <a href="/tags/rails.html">rails</a>
                </li>
                <li>
                  <a href="/tags/test.html">test</a>
                </li>
                <li>
                  <a href="/tags/performance.html">performance</a>
                </li>
              </ul>
            </div>
            <div class="article">
              <h1 class="title">Тестируем RAM, SSD и HDD на скорость</h1><p>Сейчас я потихньку занимаюсь своим проектом, когда есть свободное время, и вот недавно выпал вопрос о железе для хостинга. Облака я рассматривать пока не буду, т.к. железки там сказать в принципе не смогут, только если везде стоят одни и те-же. Кстати, скоро ко мне попадет в руки тестовый аккаунт на новой облачной площадке, там и потестирую что и как быстро работает. А сейчас я хочу рассказать о производительности SSD vs <a href="http://ru.wikipedia.org/wiki/RAM_drive">RAM Drive</a> vs HDD.</p>

<p>Тесты проводились на компьютере с OS X, 4x4Gb Kingston @ 1333 RAM, Intel Core i3 @ 2.8 Ghz, OCZ Vertex3 @ 120Gb, HDD Seagate ST3000DM001 @ 3Tb. OS X, конечно же, установлена на SSD, Ruby с гемами расположены в домашней папке. Я создал Rails приложение, создал 10.000 записей в sqlite и контроллер со следующим кодом:</p>
<div class="CodeRay">
  <div class="code"><pre><span class="instance-variable">@products</span> = <span class="constant">Product</span>.all
<span class="constant">Rails</span>.cache.clear
</pre></div>
</div>

<p>Кстати, записи на странице не рендерил, подумал что это будет лишним.</p>

<p>Дальше связка nginx + unicorn и тестирование нагрузки. Сначала хотел использовать siege, но что-то там не срослось, давно уже было, не помню :) И таки взял ab.</p>

<p>Результаты получились очень странными:</p>
<h2 id="hdd">HDD</h2><div class="CodeRay">
  <div class="code"><pre>Document Length:      719 bytes
Concurrency Level:    4
Time taken for tests: 40.510 seconds
Complete requests:    100
Failed requests:      0
Total transferred:    130600 bytes
HTML transferred:     71900 bytes
Requests per second:  2468.54
Transfer rate:        3223.92 kb/s received
            Connnection Times (ms)
            min     avg     max
Connect:    0       0       0
Processing: 1193    1596    2400
Total:      1193    1596    2400
</pre></div>
</div>
<h2 id="ram-disk">RAM disk</h2><div class="CodeRay">
  <div class="code"><pre>Document Length:      719 bytes
Concurrency Level:    4
Time taken for tests: 39.272 seconds
Complete requests:    100
Failed requests:      0
Total transferred:    130600 bytes
HTML transferred:     71900 bytes
Requests per second:  2546.33
Transfer rate:        3325.51 kb/s received
            Connnection Times (ms)
            min     avg     max
Connect:    0       0       0
Processing: 366     1546    1645
Total:      366     1546    1645
</pre></div>
</div>
<h2 id="ssd">SSD</h2><div class="CodeRay">
  <div class="code"><pre>Document Length:      719 bytes
Concurrency Level:    4
Time taken for tests: 39.274 seconds
Complete requests:    100
Failed requests:      0
Total transferred:    130600 bytes
HTML transferred:     71900 bytes
Requests per second:  2546.21
Transfer rate:        3325.35 kb/s received
            Connnection Times (ms)
            min     avg     max
Connect:    0       0       0
Processing: 398     1546    1627
Total:      398     1546    1627
</pre></div>
</div>

<p>И для удобства:</p>
<div class="CodeRay">
  <div class="code"><pre>            Connnection Times (ms)  RPS
            min     avg     max
HDD:        1193    1596    2400    2468.54
RAM Disk:   366     1546    1645    2546.33
SSD:        398     1546    1627    2546.21
</pre></div>
</div>

<p>В следующий раз буду проводить тест SSD vs RAM disk уже на серверной машине, и Ruby с гемами положу в оперативную память, когда буду ее тестировать, а то сейчас, как мне кажется, у RAM не сильный выигрышь просто потому что сам руби был на SSD.</p>

<p>Ну и в следующий раз постараюсь с графиками, а то голые цифры мне совсем не нравятся.</p>
<h3 id="upd">UPD</h3>
<p>В комментариях посоветовали провести тесты на запись, результаты получились адекватнее.</p>

<p>Код тестирования записи:</p>
<div class="CodeRay">
  <div class="code"><pre><span class="integer">1</span>.upto(<span class="integer">100</span>) <span class="keyword">do</span> |i|
  <span class="constant">Product</span>.create <span class="keyword">do</span> |p|
    p.code = rand <span class="integer">10_000</span>
    p.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
    p.shown = [<span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>].sample
    p.description = <span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></div>
</div>
<h2 id="hdd">HDD</h2><div class="CodeRay">
  <div class="code"><pre>Document Length:      975 bytes
Concurrency Level:    4
Time taken for tests: 83.542 seconds
Complete requests:    100
Failed requests:      0
Non-2xx responses:    100
Total transferred:    124700 bytes
HTML transferred:     97500 bytes
Requests per second:  1197.00
Transfer rate:        1492.65 kb/s received
            Connnection Times (ms)
            min     avg     max
Connect:    0       0       0
Processing: 540     3290    4829
Total:      540     3290    4829
</pre></div>
</div>
<h2 id="ram-disk">RAM disk</h2><div class="CodeRay">
  <div class="code"><pre>Document Length:      972 bytes
Concurrency Level:    4
Time taken for tests: 13.850 seconds
Complete requests:    100
Failed requests:      0
Non-2xx responses:    100
Total transferred:    124400 bytes
HTML transferred:     97200 bytes
Requests per second:  7220.03
Transfer rate:        8981.72 kb/s received
            Connnection Times (ms)
            min     avg     max
Connect:    0       0       0
Processing: 130     545     577
Total:      130     545     577
</pre></div>
</div>
<h2 id="ssd">SSD</h2><div class="CodeRay">
  <div class="code"><pre>Document Length:      974 bytes
Concurrency Level:    4
Time taken for tests: 15.569 seconds
Complete requests:    100
Failed requests:      0
Non-2xx responses:    100
Total transferred:    124600 bytes
HTML transferred:     97400 bytes
Requests per second:  6422.87
Transfer rate:        8002.89 kb/s received
            Connnection Times (ms)
            min     avg     max
Connect:    0       0       0
Processing: 183     613     664
Total:      183     613     664
</pre></div>
</div>

<p>И для удобства:</p>
<div class="CodeRay">
  <div class="code"><pre>            Connnection Times (ms)  RPS
            min     avg     max
HDD:        540     3290    4829    1197.00
RAM Disk:   130     545     577     7220.03
SSD:        183     613     664     6422.87
</pre></div>
</div>

<p><img alt="Результаты" src="Ram-ssd-hdd/chart.png?1354701016" /></p>
</div>
          </div><div class="post comments" id="comments">
            <div class="meta">
              <h6>Комментарии</h6>
            </div>
            <div class="article">
              <div id="disqus_thread"></div>
              <script type="text/javascript">var disqus_shortname = 'artemeff';
                
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();</script>
              <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">>comments powered by Disqus.</a></noscript>
            </div>
          </div></div><div class="slider">
          <a href="/blog/2012/Blog-updates.html" title="Обновление бложика">« назад</a><a href="/blog/2012/Ruby-2-0.html" title="Ruby 2.0, что нас ждет?">вперед »</a>
        </div></div>
    </div>
    <script type="text/javascript">var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-27383670-1']);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();</script>
  </body>
</html>